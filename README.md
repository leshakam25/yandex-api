# Яндекс API Прокси

Приложение для работы с API Яндекс 360, обходящее ограничения CORS и предоставляющее удобный пользовательский интерфейс.

## Возможности

- Авторизация через Яндекс OAuth
- Просмотр профиля пользователя
- Редактирование имени пользователя
- Просмотр списка пользователей организации
- Работа с API Яндекс 360 без проблем с CORS

## Установка

1. Клонируйте репозиторий:

```bash
git clone [ссылка на репозиторий]
cd yandex-api
```

2. Установите зависимости:

```bash
npm install
```

3. Создайте файл `.env.local` на основе примера:

```bash
cp .env.example .env.local
```

4. Заполните переменные окружения в файле `.env.local`:

- `ORG_ID` - ID вашей организации в Яндекс 360
- `NEXT_PUBLIC_YANDEX_CLIENT_ID` - ID вашего приложения в Яндекс OAuth
- `YANDEX_CLIENT_SECRET` - Секрет вашего приложения в Яндекс OAuth
- `NEXTAUTH_SECRET` - Случайная строка для шифрования сессий (можно сгенерировать с помощью `openssl rand -base64 32`)

## Настройка разрешений Яндекс OAuth

Для работы с API Яндекс 360 необходимы специальные разрешения. Выполните следующие шаги:

1. Войдите в [консоль разработчика Яндекса](https://oauth.yandex.ru/)
2. Найдите ваше приложение или создайте новое
3. В разделе "Доступы" включите "**Яндекс 360 для организации: Управление организацией**"
4. После активации этих разрешений откройте файл `app/api/services/config.ts` и добавьте следующие права в массив `API_SCOPES`:
   
   ```typescript
   export const API_SCOPES = [
     'login:email',
     'login:info',
     'login:avatar',
     'directory:read',    // Чтение информации о пользователях
     'directory:write'    // Редактирование информации о пользователях
   ];
   ```

5. Перезапустите приложение

> **Примечание**: Без настройки этих разрешений функции просмотра и редактирования пользователей организации будут недоступны.

## Получение ID организации

ID организации можно получить из URL административной панели Яндекс 360:

1. Войдите в административную панель Яндекс 360: https://admin.yandex.ru/
2. Перейдите в раздел "Профиль организации"
3. В URL будет содержаться ID организации: `https://admin.yandex.ru/company/{ID_организации}/profile`

Или воспользуйтесь API Яндекс 360:

1. Получите токен с правами `directory:read`
2. Выполните запрос к `https://api360.yandex.net/directory/v1/org`

## Запуск приложения

Для удобства запуска в Windows PowerShell можно использовать скрипты:

1. Настройка переменных окружения:

```bash
./setup-env.ps1
```

2. Запуск приложения:

```bash
./start.ps1
```

Или вручную:

```bash
npm run dev
```

Приложение будет доступно по адресу: http://localhost:3000

## Устранение неполадок

### Ошибка 400 Bad Request при загрузке пользователей

Проверьте следующее:

1. ID организации установлен правильно в файле `.env.local`
2. Токен OAuth имеет право `directory:read`
3. Приложение запущено с корректными переменными окружения

### Ошибка CORS при работе с API

В данном приложении используется прокси-сервер для обхода ограничений CORS. Если вы видите ошибки CORS, убедитесь, что запросы идут через прокси-эндпоинты (`/api/proxy/*`), а не напрямую к API Яндекса.

## Технологии

- Next.js 14
- React
- Tailwind CSS
- Axios
- NextAuth.js
- API Яндекс 360

## Структура проекта

```
/app
  /api
    /auth - Аутентификация через NextAuth.js
    /proxy - Прокси-эндпоинты для API Яндекс
      /user - Информация о пользователе
      /users - Список пользователей организации
  /components - React компоненты
    /ui - Общие UI компоненты
  /services - Сервисы для работы с API
  /styles - CSS стили
```

## Основные возможности

- Просмотр информации о пользователях
- Редактирование имени пользователя
- Интерфейс для работы с API Яндекс 360
- Типизированные компоненты и сервисы

## Настройка переменных окружения

Для работы с API Яндекс 360 требуется указать ID вашей организации. Вы можете использовать скрипт `setup-env.ps1` для автоматической настройки или создать файл `.env.local` вручную со следующим содержимым:

```
ORG_ID=ваш_ID_организации
```

### Как получить ID организации в Яндекс 360

1. Войдите в [Яндекс 360 для бизнеса](https://admin.yandex.ru/)
2. Перейдите в раздел "Настройки организации"
3. ID организации отображается в URL адресе в формате:
   `https://admin.yandex.ru/company/{ID_организации}/profile`
4. Скопируйте числовой ID из URL (например, `123456789`)

## Дополнительная информация

Дополнительную информацию о работе с API Яндекс 360 можно найти в [официальной документации](https://yandex.ru/dev/api360/doc/ru/)

## Дальнейшее развитие проекта

- Добавление полной поддержки OAuth аутентификации
- Реализация управления группами и подразделениями
- Добавление управления доменами
- Разработка интерфейса для работы с правилами обработки писем
- Внедрение аудита и логирования действий

## Лицензия

MIT
